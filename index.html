<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progresso de Metragem</title>
    <style>
        .loading-bar-container {
            width: 100%;
            height: 30px;
            border: 1px solid black;
            background-color: #f0f0f0;
            position: relative;
            overflow: hidden;
        }
        .loading-bar {
            width: 0;
            height: 100%;
            background-color: green;
            transition: width 0.5s ease;
        }
        .marking {
            width: 2px;
            height: 100%;
            background-color: red;
            position: absolute;
        }
        .digital-display {
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div>
        <label for="metragem1">Metragem OP:</label>
        <input type="number" id="metragem1" placeholder="Digite a metragem">
        <label for="er1">ER:</label>
        <input type="number" id="er1" placeholder="Digite a ER">
        <label for="eficiencia1">Eficiência (%):</label>
        <input type="number" id="eficiencia1" placeholder="Digite a eficiência">
        <button onclick="calcular(1)">Calcular</button>
        <button onclick="iniciarProgresso(1)">Iniciar Progresso</button>
        <button onclick="adicionarBobina(1)">Adicionar Bobina</button>
        <button onclick="resetarCorCírculo(1)">Resetar Cor</button>
    </div>

    <div class="loading-bar-container">
        <div id="loading-bar1" class="loading-bar"></div>
    </div>
    <div id="digital-display1" class="digital-display">0.00 m</div>
    <div id="progress-indicator1"></div>
    <div id="circle1" style="width: 20px; height: 20px; background-color: green; border-radius: 50%;"></div>

    <script>
        let consumos = [0];
        let marcacoes = [0]; // Marcações acumuladas
        let velocidades = [0];
        let intervalo;

        function calcular(op) {
            let metragem = parseFloat(document.getElementById(`metragem${op}`).value);
            let er = parseFloat(document.getElementById(`er${op}`).value);
            let eficiencia = parseFloat(document.getElementById(`eficiencia${op}`).value);

            if (!metragem || !er || !eficiencia) {
                alert("Preencha todos os campos.");
                return;
            }

            let tempoConsumo = metragem / (er * (eficiencia / 100));
            let velocidadeConsumo = metragem / tempoConsumo;

            document.getElementById(`tempo-consumo${op}`).textContent = tempoConsumo.toFixed(2);
            document.getElementById(`velocidade-consumo${op}`).textContent = velocidadeConsumo.toFixed(2);

            velocidades[op - 1] = velocidadeConsumo;
            document.getElementById(`circle${op}`).style.backgroundColor = "yellow";
        }

        function iniciarProgresso(op) {
            let metragem = parseFloat(document.getElementById(`metragem${op}`).value);

            if (!metragem) {
                alert("Digite a metragem da OP.");
                return;
            }

            consumos[op - 1] = 0; // Reinicia consumo
            let consumoAtual = consumos[op - 1];
            let velocidade = velocidades[op - 1];
            let tamanhoTotal = metragem * 1.3; // 130% do valor digitado

            clearInterval(intervalo);
            intervalo = setInterval(() => {
                consumoAtual += velocidade / 60; // Incremento por segundo
                consumos[op - 1] = consumoAtual;
                atualizarBarra(op, consumoAtual, tamanhoTotal);
                verificarMarca(op, consumoAtual);

                if (consumoAtual >= tamanhoTotal) clearInterval(intervalo);
            }, 1000); // Atualiza a cada segundo
        }

        function adicionarBobina(op) {
            let bobinaEntrada = parseFloat(document.getElementById(`bobina-entrada${op}`).value);
            let metragem = parseFloat(document.getElementById(`metragem${op}`).value);

            if (!bobinaEntrada) {
                alert("Digite a bobina de entrada.");
                return;
            }

            consumos[op - 1] += bobinaEntrada;
            let somaMarcações = marcacoes.reduce((acc, val) => acc + val, 0);
            marcacoes.push(somaMarcações + bobinaEntrada);
            marcarBobina(op, somaMarcações + bobinaEntrada, metragem);
        }

        function marcarBobina(op, consumoAtual, metragem) {
            let tamanhoTotal = metragem * 1.3; // Usa 130% do valor digitado
            let porcentagem = (consumoAtual / tamanhoTotal) * 100;
            let marcador = document.createElement("div");
            marcador.classList.add("marking");
            marcador.style.left = `${porcentagem}%`;
            document.querySelector(".loading-bar-container").appendChild(marcador);
        }

        function verificarMarca(op, consumoAtual) {
            for (let i = 0; i < marcacoes.length; i++) {
                if (Math.abs(consumoAtual - marcacoes[i]) < 0.1) {
                    document.getElementById(`circle${op}`).style.backgroundColor = "red";
                }
            }
        }

        function atualizarBarra(op, consumoAtual, tamanhoTotal) {
            let porcentagem = (consumoAtual / tamanhoTotal) * 100;
            porcentagem = Math.min(porcentagem, 100);
            document.getElementById(`loading-bar${op}`).style.width = `${porcentagem}%`;
            document.getElementById(`progress-indicator${op}`).textContent = `${consumoAtual.toFixed(2)} m`;
            document.getElementById(`digital-display${op}`).textContent = `${consumoAtual.toFixed(2)} m`;
        }

        function resetarCorCírculo(op) {
            document.getElementById(`circle${op}`).style.backgroundColor = "green";
        }
    </script>
</body>
</html>
